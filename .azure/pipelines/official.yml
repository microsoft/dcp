trigger: none

parameters:
- name: signType
  displayName: 'Sign Type'
  values:
  - 'none'
  - 'test'
  - 'real'
  default: real
- name: testTimeout
  displayName: 'Test Timeout (seconds)'
  type: number
  default: 180

resources:
  repositories:
  - repository: 1esPipelines
    type: git
    name: 1ESPipelineTemplates/1ESPipelineTemplates
    ref: refs/tags/release

variables:
- template: common-variables.yml@self

extends:
  template: v1/1ES.Official.PipelineTemplate.yml@1esPipelines
  parameters:
    pool:
      name: NetCore1ESPool-Svc-Internal
      image: 1es-windows-2022
    containers:
      linux_build_container:
        image: 'mcr.microsoft.com/oss/go/microsoft/golang:1.24-bullseye'
        options: --name $(BuildContainerName)
    sdl:
      sourceAnalysisPool:
        name: NetCore1ESPool-Svc-Internal
        image: 1es-windows-2022
      policheck:
        enabled: true
      tsa:
        enabled: true
        config:
          codebaseName: dcp
          instanceUrl: https://dev.azure.com/devdiv/
          projectName: devdiv
          areaPath: DevDiv\ASP.NET Core\Aspire
          iterationPath: DevDiv
          notificationAlias: $(TsaNotificationEmail)
          allTools: true
    featureFlags:
      golang:
        internalModuleProxy:
          enabled: true
    stages:
    - template: common-build.yml@self
      parameters:
        signType: ${{ parameters.signType}}
        testTimeout: ${{ parameters.testTimeout}}
        windowsPool:
          name: NetCore1ESPool-Svc-Internal
          image: 1es-windows-2022
          os: windows
        linuxPool:
          name: NetCore1ESPool-Svc-Internal
          image: 1es-ubuntu-2204
          os: linux
