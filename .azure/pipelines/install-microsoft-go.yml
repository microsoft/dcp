parameters:
- name: version
  displayName: 'Go version'
  type: string
- name: urlBase
  displayName: 'Source URL'
  type: string
  default: 'https://aka.ms/golang/release/latest'
- name: os
  displayName: 'OS'
  type: string
  default: linux
- name: arch
  displayName: 'Architecture'
  type: string
  default: amd64
- name: extension
  displayName: 'Extension'
  type: string
  default: '.tar.gz'

steps:
- task: PowerShell@2
  displayName: 'Install Microsoft Go'
  inputs:
    script: |
      $uri = "$env:URLBASE/go$env:VERSION.$env:OS-$($env:ARCH)$($env:EXTENSION)"
      $outFile = "$env:AGENT_TEMPDIRECTORY/go$env:EXTENSION"
      Write-Host "Downloading $uri to $outFile"
      Invoke-WebRequest -Uri $uri -OutFile $outFile
    targetType: inline
  env:
    VERSION: ${{ parameters.version }}
    URLBASE: ${{ parameters.urlBase }}
    OS: ${{ parameters.os }}
    ARCH: ${{ parameters.arch }}
    EXTENSION: ${{ parameters.extension }}
- task: ExtractFiles@1
  displayName: 'Extract Microsoft Go'
  inputs:
    archiveFilePatterns: '$(Agent.TempDirectory)/go${{ parameters.extension }}'
    destinationFolder: '$(Agent.TempDirectory)'
    cleanDestinationFolder: false
    overwriteExistingFiles: true
